<Window x:Class="PdfStampGenerator.App.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:PdfStampGenerator.App.Converters"
        mc:Ignorable="d"
        Title="PDF Stamp Generator"
        Background="White"
        Height="600"
        Width="700">

    <!-- ================= RESOURCES ================= -->
    <Window.Resources>

        <conv:StampShapeToVisibilityConverter
            x:Key="BorderVisible"
            IsCircle="False"/>

        <conv:StampShapeToVisibilityConverter
            x:Key="CircleVisible"
            IsCircle="True"/>

        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- ===== Color Buttons ===== -->
        <DataTemplate x:Key="ColorTemplate">
            <Button Width="26"
                    Height="26"
                    Margin="4"
                    Background="{Binding}"
                    BorderBrush="Gray"
                    BorderThickness="1"
                    Command="{Binding DataContext.ColorCommand,
                                      RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}"/>
        </DataTemplate>

        <!-- ===== Fill Color ===== -->
        <DataTemplate x:Key="FillColorTemplate">
            <Button Width="26"
                    Height="26"
                    Margin="4"
                    Background="{Binding}"
                    BorderBrush="Gray"
                    BorderThickness="1"
                    Command="{Binding DataContext.SetFillColorCommand,
                                      RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}"/>
        </DataTemplate>

        <!-- ===== Border Color ===== -->
        <DataTemplate x:Key="BorderColorTemplate">
            <Button Width="26"
                    Height="26"
                    Margin="4"
                    Background="{Binding}"
                    BorderBrush="Gray"
                    BorderThickness="1"
                    Command="{Binding DataContext.SetBorderColorCommand,
                                      RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}"/>
        </DataTemplate>

        <!-- ===== Font Color ===== -->
        <DataTemplate x:Key="FontColorTemplate">
            <Button Width="26"
                    Height="26"
                    Margin="4"
                    Background="{Binding}"
                    BorderBrush="Gray"
                    BorderThickness="1"
                    Command="{Binding DataContext.SetFontColorCommand,
                                      RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}"/>
        </DataTemplate>

    </Window.Resources>

    <!-- ================= LAYOUT ================= -->
    <Grid Margin="10">

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ================= LEFT PANEL ================= -->
        <ScrollViewer Grid.Column="0"
                      VerticalScrollBarVisibility="Auto">

            <StackPanel Margin="0,0,20,0">

                <TextBlock Text="Stamp Settings"
                           FontWeight="Bold"
                           FontSize="16"
                           Margin="0,0,0,15"/>

                <!-- Shape -->
                <TextBlock Text="Shape" FontWeight="SemiBold"/>
                <ComboBox ItemsSource="{Binding Shapes}"
                          SelectedItem="{Binding Shape}"
                          Height="30"
                          Margin="0,5,0,15"/>

                <!-- Title -->
                <TextBlock Text="Title" FontWeight="SemiBold"/>
                <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"
                         Height="30"
                         Margin="0,5,0,15"/>

                <!-- Author -->
                <TextBlock Text="Author" FontWeight="SemiBold"/>
                <TextBox Text="{Binding Author, UpdateSourceTrigger=PropertyChanged}"
                         Height="30"
                         Margin="0,5,0,15"/>

                <!-- Font Size -->
                <TextBlock Text="Font Size"
                           FontWeight="SemiBold"
                           Margin="0,15,0,4"/>

                <Slider Minimum="0" Maximum="1" 
                        Value="{Binding FillOpacity, Mode=TwoWay}" 
                        TickFrequency="0.05" IsSnapToTickEnabled="True"/>


                <TextBlock Text="{Binding FontSize}"
                           HorizontalAlignment="Right"
                           Margin="0,2,0,5"/>

                <!-- Border Thickness -->
                <TextBlock Text="Border Thickness"
                           FontWeight="SemiBold"
                           Margin="0,15,0,4"/>

                <Slider Minimum="0"
                        Maximum="20"
                        Value="{Binding BorderThickness, Mode=TwoWay}"
                        TickFrequency="1"
                        IsSnapToTickEnabled="True"
                        Height="30"/>

                <TextBlock Text="{Binding BorderThickness}"
                           HorizontalAlignment="Right"
                           Margin="0,2,0,5"/>

                <!-- Fill Color -->
                <Border BorderThickness="0,0,0,2" BorderBrush="LightGray">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Fill Color"
                       FontWeight="SemiBold"
                       Margin="0,7,0,7"
                       VerticalAlignment="Center"/>

                        <ToggleButton x:Name="ToggleFillColors"
                          Width="15" Height="15" Margin="10,5"
                          Padding="2">
                            <Image Source="/Resources/down.png"/>
                        </ToggleButton>
                    </StackPanel>
                </Border>

                <Border BorderThickness="0,0,0,2" BorderBrush="LightGray" Margin="0,0,0,8">
                    <!-- Panel that toggles -->
                    <StackPanel Orientation="Vertical" Visibility="{Binding IsChecked, ElementName=ToggleFillColors, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl ItemsSource="{Binding PresetColors}"
                                      ItemTemplate="{StaticResource FillColorTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Border Color -->
                <Border BorderThickness="0,0,0,2" BorderBrush="LightGray">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Border Color"
                                    FontWeight="SemiBold"
                                    Margin="0,7,0,7"
                                    VerticalAlignment="Center"/>

                        <ToggleButton x:Name="ToggleBorderColors"
                                       Width="15" Height="15" Margin="10,5"
                                       Padding="2">
                            <Image Source="/Resources/down.png"/>
                        </ToggleButton>
                    </StackPanel>
                </Border>

                <Border BorderThickness="0,0,0,2" BorderBrush="LightGray" Margin="0,0,0,8">
                    <StackPanel Visibility="{Binding IsChecked, ElementName=ToggleBorderColors, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl ItemsSource="{Binding PresetColors}"
                                        ItemTemplate="{StaticResource BorderColorTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Font Color -->
                <Border BorderThickness="0,0,0,2" BorderBrush="LightGray">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Font Color"
                                   FontWeight="SemiBold"
                                   Margin="0,7,0,7"
                                   VerticalAlignment="Center"/>

                        <ToggleButton x:Name="ToggleFontColors"
                                       Width="15" Height="15" Margin="10,5"
                                       Padding="2">
                            <Image Source="/Resources/down.png"/>
                        </ToggleButton>
                    </StackPanel>
                    
                </Border>

                <Border BorderThickness="0,0,0,1" BorderBrush="LightGray" Margin="0,0,0,8">
                    <StackPanel Visibility="{Binding IsChecked, ElementName=ToggleFontColors, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl ItemsSource="{Binding PresetColors}"
                                        ItemTemplate="{StaticResource FontColorTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                    

            </StackPanel>
        </ScrollViewer>

        <!-- ================= RIGHT PANEL (PREVIEW + EXPORT) ================= -->
        <Border Grid.Column="1"
                Padding="20"
                BorderBrush="#DDD"
                BorderThickness="1"
                CornerRadius="6">

            <StackPanel HorizontalAlignment="Center">

                <!-- ===== PREVIEW CANVAS ===== -->
                <Grid x:Name="StampPreview"
                      Width="320"
                      MinHeight="160"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center">


                    <!-- RECTANGLE / ROUNDED -->
                    <Border MinWidth="260" MinHeight="140" MaxWidth="325"
                            Visibility="{Binding Shape, Converter={StaticResource BorderVisible}}"
                            Background="{Binding FillBrush}" BorderBrush="{Binding BorderBrush}"
                            BorderThickness="{Binding BorderThickness}" CornerRadius="{Binding CornerRadius}"
                            HorizontalAlignment="Center" VerticalAlignment="Center">

                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Margin="20">

                            <TextBlock Text="{Binding Title}"
                                       FontSize="{Binding FontSize}"
                                       FontFamily="{Binding FontFamily}"
                                       Foreground="{Binding FontBrush}"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>

                            <TextBlock Text="{Binding Author}"
                                       FontSize="16"
                                       Foreground="{Binding FontBrush}"
                                       HorizontalAlignment="Center"/>

                            <TextBlock Text="{Binding TimestampText}"
                                       FontSize="16"
                                       Foreground="{Binding FontBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- CIRCLE -->
                    <Grid Width="160"
                          Height="160"
                          Visibility="{Binding Shape, Converter={StaticResource CircleVisible}}">

                        <!--<Grid.RenderTransform>
                            <TranslateTransform X="80" Y="10"/>
                        </Grid.RenderTransform>-->

                        <Ellipse Fill="{Binding FillBrush}"
                                 Stroke="{Binding BorderBrush}"
                                 StrokeThickness="{Binding BorderThickness}"/>

                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center">

                            <TextBlock Text="{Binding Title}"
                                       FontSize="20"
                                       Margin="1"
                                       FontWeight="Bold"
                                       Foreground="{Binding FontBrush}"
                                       TextAlignment="Center"/>

                            <TextBlock Text="{Binding Author}"
                                       Foreground="{Binding FontBrush}"
                                       FontSize="16"
                                       TextAlignment="Center"/>

                            <TextBlock Text="{Binding TimestampText}"
                                       FontSize="16"
                                       Foreground="{Binding FontBrush}"
                                       TextAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                </Grid>

                <!-- ===== EXPORT BUTTONS ===== -->
                <StackPanel Orientation="Horizontal"
                            Margin="0,16,0,0"
                            HorizontalAlignment="Center">

                    <Button Content="Export PNG"
                            Width="120"
                            Margin="0,0,10,0"
                            Command="{Binding ExportPngCommand}"
                            CommandParameter="{Binding ElementName=StampPreview}"/>

                    <Button Content="Export JPEG"
                            Width="120"
                            Command="{Binding ExportJpegCommand}"
                            CommandParameter="{Binding ElementName=StampPreview}"/>

                </StackPanel>

            </StackPanel>
        </Border>

    </Grid>
</Window>
